<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>REST APIs — Backend Development</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css">
  <link rel="stylesheet" type="text/css" href="stylesheets/dark.css">
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

  <link rel="stylesheet" type="text/css" href="stylesheets/code.css">

  <link rel="stylesheet" type="text/css" href="stylesheets/fixes.css">

  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon">
  <style>

    .slide img[src$=svg] {
      width: 100%;
    }
  </style>
</head>
<body class="guide">
  <div>
    <a href="https://github.com/backend-development/backend-development-textbook/"><img style="position: fixed; top: 0; right: 0; border: 0; z-index: 10;" src="images/forkme.png" alt="Fork me on GitHub"></a>
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">More Rails: </strong>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://guides.rubyonrails.org/">Rails Guides</a></li>
        <li class="more-info"><a href="https://railsbridge.projects.multimediatechnology.at/docs/">Railsbridge</a></li>
        <li class="more-info"><a href="https://archive.org/details/podcast_railscasts_218282043">Railscasts</a></li>
      </ul>
      <strong class="more-info-label">Beyond Backend: </strong>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://web-engineering.github.io/">Web Engineering</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="Return to home page">Backend<span> Development</span></a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">Home</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" onclick="guideMenu(); return false;" id="guidesMenu" class="guides-index-item nav-item">Index  &#x25BC;</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr>
              <dl class="L">
                <dt>Ruby on Rails</dt>
                <dd><a href="ruby_commandline.html">Ruby Commandline</a></dd>
                <dd><a href="rails_database_and_model.html">Models and ActiveRecord</a></dd>
                <dd><a href="rails_db.html">Database and Migrations</a></dd>
                <dd><a href="rails_associations_and_validations.html">Associations and Validations</a></dd>
                <dd><a href="rails_view_and_controller.html">Routing, View and Controller</a></dd>
                <dd><a href="rails_authentication.html">Simple Authentication</a></dd>
                <dd><a href="asset_pipeline.html">The Asset Pipeline</a></dd>
                <dd><a href="javascript_and_ajax.html">Rails and old Javascript</a></dd>
                <dd><a href="javascript_webpack_frontend.html">Rails and Webpack</a></dd>
                <dd><a href="testing.html">Getting started with Testing</a></dd>
                <dd><a href="rails_gems.html">Ruby Gems for your Rails Project</a></dd>
                <dd><a href="rest-api.html">REST API</a></dd>
                <dd><a href="graphql-api.html">GraphQL API</a></dd>
                <dd><a href="rails_websockets.html">Websocket in Rails</a></dd>
                <dd><a href="jobs_and_tasks.html">Jobs and Tasks in Rails</a></dd>
                <dd><a href="refactoring_rails.html">Refactoring Rails</a></dd>
                <dd><a href="rails_security.html">Rails Security</a></dd>
                <dt>Overarching Concerns</dt>
                <dd><a href="security.html">Security</a></dd>
                <dd><a href="adv_authentication.html">Advanced Authentication</a></dd>
                <dd><a href="caching.html">Caching</a></dd>
                <dd><a href="advanced_testing.html">Advanced Testing</a></dd>
                <dd><a href="internationalization.html">Internationalization (I18n)</a></dd>
                <dd><a href="git_rebasing.html">Git Rebasing</a></dd>
                <dt>Nodes.js</dt>
                <dd><a href="node_vs_rails.html">Node vs. Rails</a></dd>
                <dd><a href="node_basics.html">Node Basics</a></dd>
                <dd><a href="node_websockets.html">Node Websockets</a></dd>
                <dd><a href="node_express.html">Node Web App</a></dd>
                <dd><a href="node_cluster.html">Scaling Node</a></dd>
                <dt>Next.js</dt>
                <dd><a href="nextjs.html">Next.js</a></dd>
              </dl>
              <dl class="R">
              </dl>
          </div>
        </li>
      </ul>
    </div>
  </div>

  <hr class="hide">

  <div id="feature">
    <div class="wrapper">
      <h2 id="preheader">REST APIs</h2>
                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li>
<a href="#what-is-an-api">What is an API</a>

<ul>
<li><a href="#soap-rest-and-graphql">SOAP, REST and GraphQL</a></li>
<li><a href="#api-separates-two-layers">API separates two layers</a></li>
<li><a href="#api-for-many-different-clients">API for many different clients</a></li>
<li><a href="#backend-offers-more-than-an-api">Backend offers more than an API</a></li>
</ul>
</li>
<li>
<a href="#rest">REST</a>

<ul>
<li><a href="#urls">URLS</a></li>
<li><a href="#hateoas">HATEOAS</a></li>
<li><a href="#http-methods-and-status-codes">HTTP Methods and Status Codes</a></li>
<li><a href="#multiple-representations">Multiple Representations</a></li>
<li><a href="#statelessness">Statelessness</a></li>
<li><a href="#json-api">JSON API</a></li>
<li><a href="#exploring-a-rest-api">Exploring a REST API</a></li>
<li><a href="#testing-and-documenting-a-rest-api">Testing and Documenting a REST API</a></li>
</ul>
</li>
<li>
<a href="#rails-rest-api-in-with-existing-controllers">Rails: REST API in  with existing Controllers</a>

<ul>
<li><a href="#api-for-the-sample-app">API for the sample app</a></li>
<li><a href="#creating-an-api-with-existing-controllers">creating an API with existing controllers</a></li>
<li><a href="#creating-json-with-erb-not-a-good-idea">creating JSON with erb - not a good idea</a></li>
<li><a href="#creating-json-with-jbuilder-a-better-idea">creating JSON with jbuilder - a better idea</a></li>
<li><a href="#authentication-and-the-api">Authentication and the API</a></li>
</ul>
</li>
<li>
<a href="#rails-stand-alone-rest-api">Rails: Stand Alone REST API</a>

<ul>
<li><a href="#setting-up-controllers">setting up controllers</a></li>
<li><a href="#creating-json-with-blueprinter">creating JSON with blueprinter</a></li>
</ul>
</li>
<li><a href="#see-also">See Also</a></li>
</ol>

          </div>

      <div class="rest_header">
        <h2>REST APIs</h2><p>After working through this guide you will:</p>
<ul class="checkmark">
<li>know about the thinking behind REST APIs</li>
<li>be able to configure your existing Rails controllers to offer resources as JSON</li>
<li>be able to set up an API for your Rails app that is separate from existing controllers</li>
</ul>
<p>REPO: You can study the <a href="https://github.com/backend-development/api_sample_app">code</a> and try out <a href="https://iou-brigitte.herokuapp.com">the demo</a> for the example described here.</p>
      </div>
    </div>
  </div>


  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <div class='slide'>
</div>
<div class='slide'>
<a class='slide_break' id='slide-0' href='slides_rest-api.html#/0'>▻</a>
<h3 id="what-is-an-api">
<a class="anchorlink" href="#what-is-an-api"></a>1 What is an API</h3><p>API stands for "Application Programming Interface". It is a set of clearly defined methods
of communication with a software component. So the objects and methods exposed by a library
form an API.</p><p>In Web development the acronym API is most
commonly used when the software component in question runs on a different server on the
Internet and is accessed via HTTP.</p></div>
<div class='slide'>
<a class='slide_break' id='slide-1' href='slides_rest-api.html#/1'>▻</a>
<h4 id="soap-rest-and-graphql">
<a class="anchorlink" href="#soap-rest-and-graphql"></a>1.1 SOAP, REST and GraphQL</h4><p>Currently three main API Styles are used on the Web:</p>
<ul>
<li>
<strong>SOAP</strong>, designed 1998 at Microsoft,
uses XML and POST requests to make "remote procedure calls"</li>
<li>
<strong>REST</strong>, described in 2000,
uses different HTTP Methods and Status Messages to access "resources"</li>
<li>
<strong>GraphQL</strong>, released 2015 by Facebook,
uses POST requests, it's own query language and JSON</li>
</ul>
<p>This Guide is concerned with REST, there is a second guide for <a href="/graphql-api.html">GraphQL</a>. SOAP
is rearely offered with Rails, but there is a <a href="https://github.com/savonrb/savon">soap client</a> in
ruby.</p></div>
<div class='slide'>
<a class='slide_break' id='slide-2' href='slides_rest-api.html#/2'>▻</a>
<h4 id="api-separates-two-layers">
<a class="anchorlink" href="#api-separates-two-layers"></a>1.2 API separates two layers</h4><p>Please note that any of the API styles can be used
with any backend, frontend, persistance layers:</p>
<ul>
<li>You can build a REST in front of a PHP backend using MongoDB as the database and use it from a frontend written with jQuery.</li>
<li>You can build a GraphQL API for a Rails backend using MySQL as the database and build the frontend with React.</li>
<li>You can use a CMS like Strapi through a REST API from a React frontend</li>
</ul>
<p>That's kind of the point of an API: to allow different technologies
on both sides of the API.</p></div>
<div class='slide'>
<a class='slide_break' id='slide-3' href='slides_rest-api.html#/3'>▻</a>
<h4 id="api-for-many-different-clients">
<a class="anchorlink" href="#api-for-many-different-clients"></a>1.3 API for many different clients</h4><p>Using an API you can build a common backend for different cleints:</p>
<ul>
<li>one client could be a native mobile app for iOS</li>
<li>another client could be a natvie mobile app for Android</li>
<li>a third client could be a Single Page App written with React</li>
</ul>
</div>
<div class='slide'>
<a class='slide_break' id='slide-4' href='slides_rest-api.html#/4'>▻</a>
<h4 id="backend-offers-more-than-an-api">
<a class="anchorlink" href="#backend-offers-more-than-an-api"></a>1.4 Backend offers more than an API</h4><p>Your "backend" might still offer some "Server Rendered HTML" besides
the API:</p>
<ul>
<li>Documentation for the API (e.g. swagger, see below)</li>
<li>AdminPanel (e.g. created automatically by rails_admin)</li>
</ul>
</div>
<div class='slide'>
<a class='slide_break' id='slide-5' href='slides_rest-api.html#/5'>▻</a>
<h3 id="rest">
<a class="anchorlink" href="#rest"></a>2 REST</h3><p>The acronym REST was coined by <a href="https://roy.gbiv.com/">Roy Fielding</a> in his dissertation. When describing
the architecture of the web, and what made it so successful on a technical level,
he described this architecture as "Representational State Transfer" (REST).</p><p>This Acronym was later picked up to describe a certain style of API,
and to distinguish such APIs from SOAP APIs.</p></div>
<div class='slide'>
<a class='slide_break' id='slide-6' href='slides_rest-api.html#/6'>▻</a>
<p>A REST API allows to access and manipulate textual representations of <strong>Web resources</strong> using HTTP Methods and stateless operations.</p><p>"Web resources" were first defined on the World Wide Web as documents or files identified by their URLs, but today they have a much more generic and abstract definition encompassing every thing or entity that can be identified, named, addressed or handled, in any way whatsoever, on the Web.</p><p><a href="https://www.infoq.com/articles/rest-introduction">Tilkov(2007)</a> gives a brief introduction to REST. The main points are:</p>
<ol>
<li> Give every resource a unique URL</li>
<li> “Hypermedia as the engine of application state” (HATEOAS) - use URLs to reference other resources (not just ids)</li>
<li> Use HTTP Methods (and Status Codes) as intended.</li>
<li> One resource can have multiple representations, for example HTML, JSON and XML</li>
<li> Communicate statelessly - if possible!</li>
</ol>
</div>
<div class='slide'>
<a class='slide_break' id='slide-7' href='slides_rest-api.html#/7'>▻</a>
<h4 id="urls">
<a class="anchorlink" href="#urls"></a>2.1 URLS</h4><p>Give every resource a unique URL.
Please note that REST does not demand a certain form of URL.
While URLs with no parameters are often used:</p><div class="code_container">
<pre><code class="highlight plaintext">https://example.com/users/
https://example.com/users/1/
https://example.com/users/2/
https://example.com/users/3/
</code></pre>
</div>
<p>it is just as restful to use parameters:</p><div class="code_container">
<pre><code class="highlight plaintext">https://example.com/users.php
https://example.com/users.php?id=1
https://example.com/users.php?id=2
https://example.com/users.php?id=3
</code></pre>
</div>
<p>In REST, the URLs correspond to resources, which are represented by nouns.
This is a difference to SOAP, there there is typically just one endpoint:</p><div class="code_container">
<pre><code class="highlight plaintext">https://example.com/soap/router/
</code></pre>
</div>
<p>Through this endpoint you can access methods like <code>getUserData()</code> or <code>deleteUser()</code>.</p></div>
<div class='slide'>
<a class='slide_break' id='slide-8' href='slides_rest-api.html#/8'>▻</a>
<h4 id="hateoas">
<a class="anchorlink" href="#hateoas"></a>2.2 HATEOAS</h4><p>“Hypermedia as the engine of application state” means that a client interacts with a network application entirely through hypermedia, and needs no prior knowledge of URLs.</p><p>If an API returns the following JSON:</p><div class="code_container">
<pre><code class="highlight js"><span class="p">{</span>
    <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Example User</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">example@railstutorial.org</span><span class="dl">"</span>
    <span class="dl">"</span><span class="s2">profile_pics</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span> <span class="p">]</span>
<span class="p">}</span>
</code></pre>
</div>
<p>Then the Client needs to know how to get profile_pics from the API.
For example because the developer read the docs.</p><p>HATEOAS demands that the full URL is used to refer to other resources:</p><div class="code_container">
<pre><code class="highlight js"><span class="p">{</span>
    <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Example User</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">example@railstutorial.org</span><span class="dl">"</span>
    <span class="dl">"</span><span class="s2">profile_pics</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
       <span class="dl">"</span><span class="s2">https://sample.com/api/profile/pictures/2</span><span class="dl">"</span><span class="p">,</span>
       <span class="dl">"</span><span class="s2">https://sample.com/api/profile/pictures/5</span><span class="dl">"</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre>
</div>
</div>
<div class='slide'>
<a class='slide_break' id='slide-9' href='slides_rest-api.html#/9'>▻</a>
<h4 id="http-methods-and-status-codes">
<a class="anchorlink" href="#http-methods-and-status-codes"></a>2.3 HTTP Methods and Status Codes</h4><p>Use HTTP Methods (and Status Codes) as intended.</p><p>Regarding the HTTP Methods there are two important distinctions:</p>
<ul>
<li>the GET and HEAD methods should take no other action than retrieval. These methods ought to be considered <strong>safe</strong>.</li>
<li>The methods GET, HEAD, PUT and DELETE are idempotent: repeating the request will not change the end result (aside from error or expiration issues)</li>
</ul>
<p>The definition of the <a href="https://www.rfc-editor.org/rfc/rfc9110.html#methods">Methods</a> in HTTP is a quick read, and well worth it!</p><p>References for status codes:</p>
<ul>
<li><a href="https://httpstatuses.com/422">Status codes</a></li>
<li><a href="https://http.cat/">Status cats</a></li>
</ul>
<p>When building a REST API, the HTTP Protocol already defines a lot
about that API. There is no need to come up with a way to delete
a resource, or to indicate failure. HTTP already offers the DELETE method
and status codes that indicate errors.</p></div>
<div class='slide'>
<a class='slide_break' id='slide-10' href='slides_rest-api.html#/10'>▻</a>
<h4 id="multiple-representations">
<a class="anchorlink" href="#multiple-representations"></a>2.4 Multiple Representations</h4><p>The same resource can be available in different formats.
There are two common ways of requesting different formats:</p><p>With the HTTP Header <code>Accept</code>:</p><div class="code_container">
<pre><code class="highlight http"><span class="nf">GET</span> <span class="nn">/mini/person/83</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">example.com</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">application/xml</span>
</code></pre>
</div>
<p>Or by adding an "extension" as part of the URL:</p><div class="code_container">
<pre><code class="highlight plaintext">https://example.com/mini/person/83.html
https://example.com/mini/person/83.xml
https://example.com/mini/person/83.json
</code></pre>
</div>
<p>The three different versions of person number 83 might look
like this: the HTML web page:</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;h1&gt;</span>Details zu einer Person<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;&lt;img</span> <span class="na">src=</span><span class="s">"https://example.com/mini/profil/edvard_1_2.jpg"</span> <span class="nt">/&gt;</span>
Herr Edvard Paul Scissorhands hat insgesamt 4 Werke in dieser Datenbank.
Er hat den Usernamen fhs123.<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">'https://example.com/mini/werk/24'</span><span class="nt">&gt;</span>The Thin Red Line<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">'https://example.com/mini/werk/50'</span><span class="nt">&gt;</span>Der böse Wolf<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">'https://example.com/mini/werk/83'</span><span class="nt">&gt;</span>nimm zwei, schatz<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">'https://example.com/mini/werk/303'</span><span class="nt">&gt;</span>the neighbour.<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre>
</div>
<p>For an API the same resource might be represented as XML:</p><div class="code_container">
<pre><code class="highlight xml"><span class="nt">&lt;person&gt;</span>
  <span class="nt">&lt;image</span> <span class="na">ref=</span><span class="s">'https://example.com/mini/profil/edvard_1_2.jpg'</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;vorname&gt;</span>Edvard<span class="nt">&lt;/vorname&gt;</span>
  <span class="nt">&lt;nachname&gt;</span>Scissorhands<span class="nt">&lt;/nachname&gt;</span>
  <span class="nt">&lt;username&gt;</span>fhs123<span class="nt">&lt;/username&gt;</span>
  <span class="nt">&lt;werke&gt;</span>
    <span class="nt">&lt;werk</span> <span class="na">ref=</span><span class="s">'https://example.com/mini/werk/24'</span><span class="nt">&gt;</span>The Thin Red Line<span class="nt">&lt;/werk&gt;</span>
    <span class="nt">&lt;werk</span> <span class="na">ref=</span><span class="s">'https://example.com/mini/werk/50'</span><span class="nt">&gt;</span>Der böse Wolf<span class="nt">&lt;/werk&gt;</span>
    <span class="nt">&lt;werk</span> <span class="na">ref=</span><span class="s">'https://example.com/mini/werk/83'</span><span class="nt">&gt;</span>nimm zwei, schatz<span class="nt">&lt;/werk&gt;</span>
    <span class="nt">&lt;werk</span> <span class="na">ref=</span><span class="s">'https://example.com/mini/werk/303'</span><span class="nt">&gt;</span>the neighbour.<span class="nt">&lt;/werk&gt;</span>
  <span class="nt">&lt;/werke&gt;</span>
<span class="nt">&lt;/person&gt;</span>
</code></pre>
</div>
<p>or as JSON:</p><div class="code_container">
<pre><code class="highlight json"><span class="p">{</span><span class="nl">"image"</span><span class="p">:</span><span class="s2">"https://example.com/mini/profil/edvard_1_2.jpg"</span><span class="p">,</span><span class="w">
 </span><span class="nl">"vorname"</span><span class="p">:</span><span class="s2">"Edvard"</span><span class="p">,</span><span class="w">
 </span><span class="nl">"nachname"</span><span class="p">:</span><span class="s2">"Scissorhands"</span><span class="p">,</span><span class="w">
 </span><span class="nl">"werk"</span><span class="p">:[</span><span class="w">
    </span><span class="p">{</span><span class="nl">"titel"</span><span class="p">:</span><span class="s2">"The Thin Red Line"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"url"</span><span class="p">:</span><span class="s2">"https://example.com/mini/werk/24"</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nl">"titel"</span><span class="p">:</span><span class="s2">"Der böse Wolf"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"url"</span><span class="p">:</span><span class="s2">"https://example.com/mini/werk/50"</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nl">"titel"</span><span class="p">:</span><span class="s2">"nimm zwei, schatz"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"url"</span><span class="p">:</span><span class="s2">"https://example.com/mini/werk/83"</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nl">"titel"</span><span class="p">:</span><span class="s2">"the neighbour."</span><span class="p">,</span><span class="w">
     </span><span class="nl">"url"</span><span class="p">:</span><span class="s2">"https://example.com/mini/werk/303"</span><span class="p">}]}</span><span class="w">
</span></code></pre>
</div>
</div>
<div class='slide'>
<a class='slide_break' id='slide-11' href='slides_rest-api.html#/11'>▻</a>
<h4 id="statelessness">
<a class="anchorlink" href="#statelessness"></a>2.5 Statelessness</h4><p>Tilkov wirtes: "REST mandates that state be either turned into resource state, or kept on the client. In other words, a server should not have to retain some sort of communication state for any of the clients it communicates with beyond a single request."</p><p>This is important for performance and scalability.
 Statelessness makes caching easy. And in a scenario with multiple servers behind a load balancer, having no state on the server means that the application will work when a client's requests are routed to different servers.</p></div>
<div class='slide'>
<a class='slide_break' id='slide-12' href='slides_rest-api.html#/12'>▻</a>
<h4 id="json-api">
<a class="anchorlink" href="#json-api"></a>2.6 JSON API</h4><p>When an API returns JSON data this could take many forms.
The <a href="https://jsonapi.org/">json:api specification</a> is a well thought out
convention for this.</p><p>It is imlements the HATEOS aspect of REST and defines a way to do associations and aggregation.</p><p>For smaller projects it might be overkill.</p></div>
<div class='slide'>
<a class='slide_break' id='slide-13' href='slides_rest-api.html#/13'>▻</a>
<h4 id="exploring-a-rest-api">
<a class="anchorlink" href="#exploring-a-rest-api"></a>2.7 Exploring a REST API</h4><p>You can explor a REST with several tool:</p>
<ul>
<li>
<a href="https://curl.haxx.se/docs/manual.html">curl</a> is a command line tool for sending HTTP requests</li>
<li>developer tools in the browser can edit "re-send" a request, or <a href="https://developer.mozilla.org/en-US/docs/Tools/Network_Monitor/request_list#Context_menu">copy as curl</a>
</li>
<li>
<a href="https://hoppscotch.io/">hoppscotch</a> is a browser based REST client</li>
<li>
<a href="https://insomnia.rest/download">insomnia</a> is a client you install as a native app</li>
</ul>
</div>
<div class='slide'>
<a class='slide_break' id='slide-14' href='slides_rest-api.html#/14'>▻</a>
<h4 id="testing-and-documenting-a-rest-api">
<a class="anchorlink" href="#testing-and-documenting-a-rest-api"></a>2.8 Testing and Documenting a REST API</h4><p><a href="https://swagger.io/resources/open-api/">The OpenAPI Specification</a> is a way for
specifying and documenting REST APIs.  There are a lot of tools available around it
for many different programming languages.</p><p>For Rails I recommend the gem <code>rswag</code>: with rswag you write tests (specs) for your
api, and the documentation is generated from the (successful) tests.
There is also a web-ui to read the documentation and run API requests -
<a href="https://iou-brigitte.herokuapp.com/api-docs/index.html">Swagger Web UI in the example app</a></p></div>
<div class='slide'>
<a class='slide_break' id='slide-15' href='slides_rest-api.html#/15'>▻</a>
<h3 id="rails-rest-api-in-with-existing-controllers">
<a class="anchorlink" href="#rails-rest-api-in-with-existing-controllers"></a>3 Rails: REST API in  with existing Controllers</h3><p>Rails is equipped to not just create HTML as output, but to easily
offer other representations as well.</p><p>When you look at <code>rails routes</code> you can see that the routes created by
<code>resource :user</code> could contain an optional <code>format</code>:</p><div class="code_container">
<pre><code class="highlight plaintext">                 Prefix Verb   URI Pattern                           Controller#Action
                   root GET    /                                     static_pages#home
                  users GET    /users(.:format)                      users#index
                   user GET    /users/:id(.:format)                  users#show
</code></pre>
</div>
<p>Only HTML is implemented by default. But we could use this feature
to have other formats:</p>
<ul>
<li><code>/users</code></li>
<li><code>/users.json</code></li>
<li><code>/users.xml</code></li>
<li><code>/users/1</code></li>
<li><code>/users/1.json</code></li>
<li><code>/users/1.xml</code></li>
</ul>
<p>When you try out accessing <code>/users/1.json</code> you get a response:</p><div class="code_container">
<pre><code class="highlight plaintext">406 Not Acceptable
Content-Length: 39
Content-Type: application/json; charset=utf-8

{"status":406,"error":"Not Acceptable"}
</code></pre>
</div>
<p>This error message is meant for a
client expecting JSON data. It uses both the HTTP status code
and the JSON to indicate the error.</p></div>
<div class='slide'>
<a class='slide_break' id='slide-16' href='slides_rest-api.html#/16'>▻</a>
<h4 id="api-for-the-sample-app">
<a class="anchorlink" href="#api-for-the-sample-app"></a>3.1 API for the sample app</h4><p>The "Frontend 1" in the example app expects a very simple JSON structure:</p><p>To display one user, it loads from <code>/user/1.json</code> and expects
a single JSON object with three attributes:</p><div class="code_container">
<pre><code class="highlight plaintext">{
   "id":1,
   "name":"Example User",
   "email":"example@railstutorial.org"
}
</code></pre>
</div>
<p>To display the table of users, it loads from <code>/users.json</code> and
expects a JSON array of objects like above:</p><div class="code_container">
<pre><code class="highlight plaintext">[
  {
    "id":2,
    "name":"Precious Heaney",
    "email":"example-1@railstutorial.org"
  },
  {
    "id":3,
    "name":"Warren Considine Sr.",
    "email":"example-2@railstutorial.org"
  }
]
</code></pre>
</div>
</div>
<div class='slide'>
<a class='slide_break' id='slide-17' href='slides_rest-api.html#/17'>▻</a>
<h4 id="creating-an-api-with-existing-controllers">
<a class="anchorlink" href="#creating-an-api-with-existing-controllers"></a>3.2 creating an API with existing controllers</h4><p>The scaffold generator always adds handling JSON responses
to the actions of a controller.</p><p>For handling just HTML only this code would be needed in the
create action:</p><div class="code_container">
<pre><code class="highlight plaintext">  # POST /users
  def create
    @user = User.new(user_params)
    if @user.save
      redirect_to @user, notice: 'User was successfully created.'
    else
      render :new
    end
    end
  end
</code></pre>
</div>
<p>But the scaffold generator also adds <code>resond_to</code> and <code>format</code> commands,
to handle json differently from html:</p><div class="code_container">
<pre><code class="highlight plaintext">  # POST /users
  # POST /users.json
  def create
    @user = User.new(user_params)
    respond_to do |format|
      if @user.save
        format.html {
          redirect_to @user, notice: 'User was successfully created.'
        }
        format.json {
          render :show, status: :created, location: @user
        }
      else
        format.html {
          render :new
        }
        format.json {
          render json: @user.errors, status: :unprocessable_entity
        }
      end
    end
  end
</code></pre>
</div>
<p>so in the controller we might not need to change anything to add the
API, only in the view.</p></div>
<div class='slide'>
<a class='slide_break' id='slide-18' href='slides_rest-api.html#/18'>▻</a>
<h4 id="creating-json-with-erb-not-a-good-idea">
<a class="anchorlink" href="#creating-json-with-erb-not-a-good-idea"></a>3.3 creating JSON with erb - not a good idea</h4><p>We could create views using erb in <code>app/views/users/show.json.erb</code>:</p><div class="code_container">
<pre><code class="highlight plaintext">{
  "id": &lt;%= @user.id %&gt;,
  "name": "&lt;%= @user.name %&gt;",
  "email": "&lt;%= @user.email %&gt;"
}
</code></pre>
</div>
<p>and <code>app/views/users/index.json.erb</code>:</p><div class="code_container">
<pre><code class="highlight plaintext">[
&lt;%
  @users.each_with_index do |user| %&gt;
  {
    "id": &lt;%= user.id %&gt;,
    "name": "&lt;%= user.name %&gt;",
    "email": "&lt;%= user.email %&gt;"
  },
&lt;% end %&gt;
]
</code></pre>
</div>
<p>But wait, there's a problem: there is a comma after each object,
but there should be no comma after the last.</p><div class="code_container">
<pre><code class="highlight plaintext">[
&lt;%
  max = @users.length - 1
  @users.each_with_index do |user,i| %&gt;
  {
    "id": &lt;%= user.id %&gt;,
    "name": "&lt;%= user.name %&gt;",
    "email": "&lt;%= user.email %&gt;"
  }
  &lt;%= if i &lt; max then ',' end %&gt;
&lt;% end %&gt;
]
</code></pre>
</div>
<p>And wait, there's another problem: What happens
if a users name contains a quote? For example <kbd>Jack "the Ripper"</kbd>.
That would break our current view, because we don't do proper escaping.</p></div>
<div class='slide'>
<a class='slide_break' id='slide-19' href='slides_rest-api.html#/19'>▻</a>
<h4 id="creating-json-with-jbuilder-a-better-idea">
<a class="anchorlink" href="#creating-json-with-jbuilder-a-better-idea"></a>3.4 creating JSON with jbuilder - a better idea</h4><p>Rails 5 comes with the gem <code>jbuilder</code> which helps you create JSON, and
which handles all the escaping and formatting correctly.</p><p>We need to name the view <code>app/views/users/show.json.jbuilder</code>,
and then can use the the following code to extract three properties
from the user object:</p><div class="code_container">
<pre><code class="highlight plaintext">json.id @user.id
json.name @user.name
json.email @user.email
</code></pre>
</div>
<p>There is also a shorthand for this:</p><div class="code_container">
<pre><code class="highlight plaintext">json.extract! @user, :id, :name, :email
</code></pre>
</div>
<p>For the index view we want to create a JSON array.
In <code>app/views/users/index.json.jbuilder</code> we write:</p><div class="code_container">
<pre><code class="highlight plaintext">json.array! @users do |user|
  json.extract! user, :id, :name, :email
end
</code></pre>
</div>
</div>
<div class='slide'>
<a class='slide_break' id='slide-20' href='slides_rest-api.html#/20'>▻</a>
<h4 id="authentication-and-the-api">
<a class="anchorlink" href="#authentication-and-the-api"></a>3.5 Authentication and the API</h4><p>All the authentication and access control we built into the
rails app before is still applicable to the API and JSON views.
If the "Frontend" that is using our API is displayed in a browser,
the handling of cookies and the session is exactly the same as before.</p><p>If the "Frontend" is not in a browser, but is a native mobile app or
just another server side job, we have to use an alternative to cookies.
<a href="https://backend-development.github.io/rails_authentication.html#how-to-add-state-to-http">JSON Web Tokens</a> are a solution.</p></div>
<div class='slide'>
<a class='slide_break' id='slide-21' href='slides_rest-api.html#/21'>▻</a>
<h3 id="rails-stand-alone-rest-api">
<a class="anchorlink" href="#rails-stand-alone-rest-api"></a>4 Rails: Stand Alone REST API</h3><p>To create a stand alone API we define new, separate routes under <code>/api/v1</code>.</p><div class="code_container">
<pre><code class="highlight plaintext">namespace :api do
  namespace :v1 do
    resources :users, only: [:index, :create, :show, :update, :destroy]
  end
end
</code></pre>
</div>
<p>we will be using the <code>blueprint</code> gem for creating JSON output. It does not comply with
the JSON-API specification, but it is fine for smaller projects.</p><div class="code_container">
<pre><code class="highlight plaintext">bundle add 'blueprinter'
</code></pre>
</div>
<p><strong>Beware</strong>: After adding a gem you
need to restart the rails server!</p></div>
<div class='slide'>
<a class='slide_break' id='slide-22' href='slides_rest-api.html#/22'>▻</a>
<h4 id="setting-up-controllers">
<a class="anchorlink" href="#setting-up-controllers"></a>4.1 setting up controllers</h4><p>After we defined the routes, we next need to create a controller.
As we are setting up a new hierarchy of controllers that will only
concerned with the API, it makes sense to inhert from <code>ActionController::API</code>,
not from <code>ActionController::Base</code>.</p><p>All the "normal" controllers first inhert from <code>ApplicationController</code>. We
will build a similar structure for the api controllers, the will inhert from
<code>Api::V1::BaseController</code>:</p><div class="code_container">
<pre><code class="highlight plaintext"># app/controllers/api/v1/base_controller.rb

class Api::V1::BaseController &lt; ActionController::API
end
</code></pre>
</div>
<p>The users controller is the one that's actually called by the route:</p><div class="code_container">
<pre><code class="highlight plaintext"># app/controllers/api/v1/users_controller.rb

class Api::V1::UsersController &lt; Api::V0::BaseController
  def index
    users = User.all
    render json: ...
  end

  def show
    user = User.find(params[:id])
    render json: ...
  end
end
</code></pre>
</div>
<p>The controller loads the right model, and then needs to calls a <strong>serializer</strong>  to
do the actual rendering of the json data.  We will create this serializer next.</p></div>
<div class='slide'>
<a class='slide_break' id='slide-23' href='slides_rest-api.html#/23'>▻</a>
<h4 id="creating-json-with-blueprinter">
<a class="anchorlink" href="#creating-json-with-blueprinter"></a>4.2 creating JSON with blueprinter</h4><p>With the gem blueprinter the
serializers live in the <code>/app/blueprints</code> folder.</p><div class="code_container">
<pre><code class="highlight plaintext"># app/blueprints/user_blueprint.rb

class UserBlueprint &lt; Blueprinter::Base
  identifier :id
  fields :name, :email
end
</code></pre>
</div>
<p>This serializer can be used both for single users and for arrays
of users. We can now complete the controller:</p><div class="code_container">
<pre><code class="highlight plaintext"># app/controllers/api/v1/users_controller.rb

class Api::V1::UsersController &lt; Api::V0::BaseController
  def index
    users = User.all
    render json: UserBlueprint.render(users)
  end

  def show
    user = User.find(params[:id])
    render json: UserBlueprint.render(user)
  end
end
</code></pre>
</div>
</div>
<div class='slide'>
<a class='slide_break' id='slide-24' href='slides_rest-api.html#/24'>▻</a>
<h3 id="see-also">
<a class="anchorlink" href="#see-also"></a>5 See Also</h3>
<ul>
<li>
<a href="https://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm">Fielding, Roy(2000): Architectural Styles and the Design of Network-based Software Architectures</a>. Dissertation. University of California/Irvine, USA.</li>
<li><a href="https://martinfowler.com/articles/richardsonMaturityModel.html">Fowler (2010): Richardson Maturity Model</a></li>
<li><a href="https://www.infoq.com/articles/rest-introduction">Tilkov(2007): A Brief Introduction to REST</a></li>
<li>
<a href="http://standards.rest/">standards.rest</a> a collection of standards that have developed around REST</li>
<li><a href="https://edgeguides.rubyonrails.org/action_controller_overview.html#rendering-xml-and-json-data">Rails Guide: Rendering JSON in Action Controller Overview</a></li>
<li><a href="https://edgeguides.rubyonrails.org/api_app.html">Rails Guide: Using Rails for API-only Applications</a></li>
<li><a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html">Methods HTTP/1.0</a></li>
<li><a href="https://httpstatuses.com/422">Status codes</a></li>
<li>
<a href="https://github.com/nsarno/knock">gem knock</a> for token based authentication for API only Rails apps</li>
<li>
<a href="https://api-platform.com/">API Platform</a> to build REST + GraphQL APIs in PHP</li>
<li>Halliday(2016): <a href="https://blog.codeship.com/producing-documentation-for-your-rails-api/">Producing Documentation for Your Rails API</a> for a discussion of automatic methods of documentation generation.</li>
</ul>
</div>
      </div>
    </div>
  </div>

  <hr class="hide">
  <div id="footer">
    <div class="wrapper">
      <p class="copyright">published under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/at/deed.de">creative commons by-nc-sa</a> in 2012-2023 by <a href="https://brigitte-jellinek.at">Brigitte Jellinek</a>.
      </p><p>If you want to contribute: <a href="https://github.com/backend-development/backend-development-textbook/fork">fork the source on github</a>
      </p>
    </div>
  </div>

  <script src="javascripts/jquery.min.js"></script>
  <script src="javascripts/guides.js"></script>
  </body>
</html>
