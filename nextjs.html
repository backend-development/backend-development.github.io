<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Backend Development Textbook</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

  <link rel="stylesheet" type="text/css" href="stylesheets/code.css" />

  <link rel="stylesheet" type="text/css" href="stylesheets/fixes.css" />

  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  <style>

    .slide img[src$=svg] {
      width: 100%;
    }
  </style>
</head>
<body class="guide">
  <div>
    <a href="https://github.com/backend-development/backend-development-textbook/"><img style="position: fixed; top: 0; right: 0; border: 0; z-index: 10;" src="images/forkme.png" alt="Fork me on GitHub"></a>
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">More Rails: </strong>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://guides.rubyonrails.org/">Rails Guides</a></li>
        <li class="more-info"><a href="https://railsbridge.projects.multimediatechnology.at/docs/">Railsbridge</a></li>
        <li class="more-info"><a href="https://archive.org/details/podcast_railscasts_218282043">Railscasts</a></li>
      </ul>
      <strong class="more-info-label">Beyond Backend: </strong>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://web-engineering.github.io/">Web Engineering</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="Return to home page">Backend<span> Development</span></a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">Home</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" onclick="guideMenu(); return false;" id="guidesMenu" class="guides-index-item nav-item">Index  &#x25BC;</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
              <dl class="L">
                <dt>Ruby on Rails</dt>
                <dd><a href="ruby_commandline.html">Ruby Commandline</a></dd>
                <dd><a href="rails_database_and_model.html">Database and Models</a></dd>
                <dd><a href="rails_associations_and_validations.html">Associations and Validations</a></dd>
                <dd><a href="rails_view_and_controller.html">Routing, View and Controller</a></dd>
                <dd><a href="rails_authentication.html">Simple Authentication</a></dd>
                <dd><a href="asset_pipeline.html">The Asset Pipeline</a></dd>
                <dd><a href="javascript_and_ajax.html">Rails and old Javascript</a></dd>
                <dd><a href="javascript_webpack_frontend.html">Rails and Webpack</a></dd>
                <dd><a href="testing.html">Getting started with Testing</a></dd>
                <dd><a href="rails_gems.html">Ruby Gems for your Rails Project</a></dd>
                <dd><a href="rest-api.html">REST API</a></dd>
                <dd><a href="graphql-api.html">GraphQL API</a></dd>
                <dd><a href="rails_websockets.html">Websocket in Rails</a></dd>
                <dd><a href="jobs_and_tasks.html">Jobs and Tasks in Rails</a></dd>
                <dd><a href="refactoring_rails.html">Refactoring Rails</a></dd>
                <dd><a href="rails_security.html">Rails Security</a></dd>
                <dt>Overarching Concerns</dt>
                <dd><a href="security.html">Security</a></dd>
                <dd><a href="adv_authentication.html">Advanced Authentication</a></dd>
                <dd><a href="caching.html">Caching</a></dd>
                <dd><a href="advanced_testing.html">Advanced Testing</a></dd>
                <dd><a href="internationalization.html">Internationalization (I18n)</a></dd>
                <dt>Nodes.js</dt>
                <dd><a href="node_vs_rails.html">Node vs. Rails</a></dd>
                <dd><a href="node_basics.html">Node Basics</a></dd>
                <dd><a href="node_websockets.html">Node Websockets</a></dd>
                <dd><a href="node_express.html">Node Web App</a></dd>
                <dd><a href="node_cluster.html">Scaling Node</a></dd>
                <dt>Next.js</dt>
                <dd><a href="nextjs.html">Next.js</a></dd>
              </dl>
              <dl class="R">
              </dl>
          </div>
        </li>
      </ul>
    </div>
  </div>

  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2 id="preheader">no heading</h2>
                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li><a href="#what-is-next-js-questionmark">What is next.js?</a></li>
<li><a href="#what-does-it-offer-questionmark">What does it offer?</a></li>
<li><a href="#the-missing-persistance-layer">The missing persistance layer</a></li>
<li><a href="#next-js-routing">next.js routing</a></li>
<li>
<a href="#next-js-as-a-static-site-generator">next.js as a Static Site Generator</a>

<ul>
<li><a href="#next-config-js-for-static-site-generation">next.config.js for static site generation</a></li>
<li><a href="#using-github-or-gitlab-pages">using github or gitlab pages</a></li>
</ul>
</li>
<li><a href="#next-js-for-api-endpoints">next.js for API endpoints</a></li>
<li><a href="#server-side-rendering-ssr">Server Side Rendering (SSR)</a></li>
<li>
<a href="#react-server-components">React Server Components</a>

<ul>
<li><a href="#how-to-use-rsc">How to use RSC</a></li>
<li><a href="#server-components-can-contain-client-components">Server Components can contain client components:</a></li>
<li><a href="#client-components-cannot-contain-server-components">Client Components cannot contain server components:</a></li>
<li><a href="#you-can-pass-in-server-components-to-a-clientcomponent">You can pass in Server Components to a ClientComponent</a></li>
<li><a href="#server-comopnents-cannot-pass-functions-to-its-descendents">Server Comopnents cannot pass functions to its descendents</a></li>
<li><a href="#how-rsc-works">How RSC Works</a></li>
</ul>
</li>
<li><a href="#hosting-next-js">Hosting next.js</a></li>
<li><a href="#see-also">See Also</a></li>
</ol>

          </div>

      <div class="rest_header">
        
      </div>
    </div>
  </div>


  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <div class='slide'><a id='slide-0'></a>
</div>
<div class='slide'>
<a class='slide_break' id='slide-1' href='slides_nextjs.html#slide-1'>▻</a>
<h2>Next.js</h2><p>Next.js is a framework for react
that also includes backend functionality.</p><p>After working through this guide you should</p>
<ul>
<li>know how to build server rendered pages in next.js</li>
<li>know how to build api endpoints in next.js</li>
</ul>

</div>
<div class='slide'>
<a class='slide_break' id='slide-2' href='slides_nextjs.html#slide-2'>▻</a>
<hr>
</div>
<div class='slide'>
<a class='slide_break' id='slide-3' href='slides_nextjs.html#slide-3'>▻</a>
<h3 id="what-is-next-js-questionmark"><a class="anchorlink" href="#what-is-next-js-questionmark">1 What is next.js?</a></h3><p>Next.js is an open source framework, but it is mainly developed by Vercel.
Vercels business is platform a service. They published next.js in 2016.
React documentation mentions Next.js among "Recommended Toolchains"
since at least 2021.</p></div>
<div class='slide'>
<a class='slide_break' id='slide-4' href='slides_nextjs.html#slide-4'>▻</a>
<h3 id="what-does-it-offer-questionmark"><a class="anchorlink" href="#what-does-it-offer-questionmark">2 What does it offer?</a></h3><p>Next.js gives you a folder structure for you application,
and several different ways to render webpages:</p>
<ul>
<li>static webpages that are rendered once, at build time.</li>
<li>api endpoints</li>
<li>server rendered pages that are served as HTML, but can be refreshed.</li>
<li>React Server Components, where you can mix client and server side components in one react tree</li>
</ul>
</div>
<div class='slide'>
<a class='slide_break' id='slide-5' href='slides_nextjs.html#slide-5'>▻</a>
<h3 id="the-missing-persistance-layer"><a class="anchorlink" href="#the-missing-persistance-layer">3 The missing persistance layer</a></h3><p>Next.js is not a full backend framework. For example it does not offer an
ORM or another persistance layer.  There is good documentation for
combining nextjs with</p>
<ul>
<li>
<a href="https://supabase.com/docs/guides/getting-started/quickstarts/nextjs">superbase</a>, which offers postgres as a service</li>
<li>
<a href="https://www.apollographql.com/blog/apollo-client/next-js/how-to-use-apollo-client-with-next-js-13/">apollo</a>, which offers graphql</li>
<li>
<a href="https://www.prisma.io/nextjs">prisma</a>, a ORM for typescript or javascript</li>
</ul>
</div>
<div class='slide'>
<a class='slide_break' id='slide-6' href='slides_nextjs.html#slide-6'>▻</a>
<h3 id="next-js-routing"><a class="anchorlink" href="#next-js-routing">4 next.js routing</a></h3><p>From <code>next.js</code> 13 onwards the routes are created in the <code>app/</code> directory.
<code>page.js</code> is the default (like index.html used to be), folders can contain parameters in brackets:</p><div class="code_container">
<pre><code class="highlight plaintext">app/page.js          --&gt;   /
app/otherpage/page.js     --&gt;   /otherpage
app/users/page.js    --&gt;   /users/
app/users/[:id]/page.js   --&gt;   /users/42/
</code></pre>
</div>
<p>There are special files:</p>
<ul>
<li>
<code>layout.js</code> for <a href="https://nextjs.org/docs/app/building-your-application/routing/pages-and-layouts#nesting-layouts">nested layouts</a>
</li>
<li>
<code>error.js</code>  for <a href="https://nextjs.org/docs/app/building-your-application/routing/error-handling">error handling</a> with error boundaries</li>
</ul>
<p><img src="images/nested-layouts-ui.png" alt=""></p></div>
<div class='slide'>
<a class='slide_break' id='slide-7' href='slides_nextjs.html#slide-7'>▻</a>
<h3 id="next-js-as-a-static-site-generator"><a class="anchorlink" href="#next-js-as-a-static-site-generator">5 next.js as a Static Site Generator</a></h3><p>You can use <code>next.js</code> like <code>jekyll</code>, <code>eleventy</code> or <code>gatsby</code> as a <a href="https://jamstack.org/generators/">static
site generator</a>: during build time, html files are generated and can
then be served by a minimal webserver without backend capabilities.</p><p>This is the classic <a href="https://jamstack.org/">Jamstack</a> (where JAM stands for JavaScript, API and Markup).</p><p>See <a href="https://nextjs.org/docs/pages/building-your-application/rendering/static-site-generation">Static Site Generation (SSG)</a></p>
<ul>
<li>create a nextjs app</li>
<li>in next.config.js add one or two values (see below)</li>
<li><code>npm run build</code></li>
<li>find the static files in folder <code>out/</code>
</li>
</ul>
</div>
<div class='slide'>
<a class='slide_break' id='slide-8' href='slides_nextjs.html#slide-8'>▻</a>
<h4 id="next-config-js-for-static-site-generation"><a class="anchorlink" href="#next-config-js-for-static-site-generation">5.1 next.config.js for static site generation</a></h4><p>We must set <code>output</code> to <code>export</code> to enable static site generations.</p><p>For most Webserver for static pages we need to set <code>trailingSlash</code> to <code>true</code>.</p><p>If the site will be hosted in a subfolder, for example at <a href="http://bjelline.pages.mediacube.at/statixnextjs/">http://bjelline.pages.mediacube.at/statixnextjs/</a>
we must configure this as the basepath:</p><div class="code_container">
<pre><code class="highlight plaintext">const nextConfig = {
  output: 'export',
  trailingSlash: true,
  basePath: '/foldername',
}
</code></pre>
</div>
</div>
<div class='slide'>
<a class='slide_break' id='slide-9' href='slides_nextjs.html#slide-9'>▻</a>
<h4 id="using-github-or-gitlab-pages"><a class="anchorlink" href="#using-github-or-gitlab-pages">5.2 using github or gitlab pages</a></h4><p>You can host your static files gitlab pages with the following configuration:
gitlab CI is used to build the pages, and the resulting folder <code>out</code> is declared
as an artifact.  Gitlab will pick up this artifact and serve it through its
pages webserver.</p><div class="code_container">
<pre><code class="highlight plaintext">image: node

before_script:
  - npm install

cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
    - node_modules/
    - .next/cache/

pages:
  script:
    - npm run build
    - mv public old_republic
    - mv out public
  artifacts:
    paths:
      - public
  only:
    - main
</code></pre>
</div>
</div>
<div class='slide'>
<a class='slide_break' id='slide-10' href='slides_nextjs.html#slide-10'>▻</a>
<h3 id="next-js-for-api-endpoints"><a class="anchorlink" href="#next-js-for-api-endpoints">6 next.js for API endpoints</a></h3><p>Use files called <code>route.js</code> as <a href="https://nextjs.org/docs/app/building-your-application/routing/router-handlers">route handlers</a> to implement the endpoints.</p><div class="code_container">
<pre><code class="highlight js"><span class="c1">// file /app/greeting/route.js</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">NextResponse</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next/server</span><span class="dl">'</span>

<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">GET</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">NextResponse</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="dl">"</span><span class="s2">hello</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">world</span><span class="dl">"</span> <span class="p">})</span>
<span class="p">}</span>
</code></pre>
</div>
</div>
<div class='slide'>
<a class='slide_break' id='slide-11' href='slides_nextjs.html#slide-11'>▻</a>
<h3 id="server-side-rendering-ssr"><a class="anchorlink" href="#server-side-rendering-ssr">7 Server Side Rendering (SSR)</a></h3><p>With server side rendering, a HTML document is shipped to the browser.
Then the browser loads the necessary JavaScript, and
<a href="https://react.dev/reference/react-dom/hydrate#hydrating-server-rendered-html">hydrates</a> the HTML
into a client side React App.</p></div>
<div class='slide'>
<a class='slide_break' id='slide-12' href='slides_nextjs.html#slide-12'>▻</a>
<h3 id="react-server-components"><a class="anchorlink" href="#react-server-components">8 React Server Components</a></h3><p>The react render tree is composed from server and client components.  In next.js 13 all components
are server components by default.  You have to add <code>"use client";</code> on top of a component to turn
it into a client component.</p><p><img src="images/react-server-components.png" alt=""></p></div>
<div class='slide'>
<a class='slide_break' id='slide-13' href='slides_nextjs.html#slide-13'>▻</a>
<h4 id="how-to-use-rsc"><a class="anchorlink" href="#how-to-use-rsc">8.1 How to use RSC</a></h4><p>Simple rules for client and server components:</p>
<ul>
<li>Use <code>.server.js</code> and <code>.client.js</code> as filename extensions.</li>
<li>Server Components can contain client components.</li>
<li>Client Components cannot contain server components.</li>
<li>Server Components can instantiate both client and server components, and pass in a Server Component as the children prop to a ClientComponent.</li>
<li>Server Components cannot pass functions as props to its descendents, only data.</li>
</ul>
</div>
<div class='slide'>
<a class='slide_break' id='slide-14' href='slides_nextjs.html#slide-14'>▻</a>
<h4 id="server-components-can-contain-client-components"><a class="anchorlink" href="#server-components-can-contain-client-components">8.2 Server Components can contain client components:</a></h4><div class="code_container">
<pre><code class="highlight js"><span class="c1">// this is server_component.server.js</span>
<span class="k">import</span> <span class="nx">ClientComponent</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./ClientComponent.client</span><span class="dl">'</span>
<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">ServerComponent</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;&gt;</span>
      <span class="o">&lt;</span><span class="nx">ClientComponent</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="sr">/</span><span class="err">&gt;
</span>  <span class="p">)</span>
<span class="p">}</span>
</code></pre>
</div>
</div>
<div class='slide'>
<a class='slide_break' id='slide-15' href='slides_nextjs.html#slide-15'>▻</a>
<h4 id="client-components-cannot-contain-server-components"><a class="anchorlink" href="#client-components-cannot-contain-server-components">8.3 Client Components cannot contain server components:</a></h4><div class="code_container">
<pre><code class="highlight js"><span class="c1">// this is client_component.client.js</span>
<span class="c1">// ERROR !!!!</span>
<span class="k">import</span> <span class="nx">ServerComponent</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./ServerComponent.server</span><span class="dl">'</span>
<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">ClientComponent</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">ServerComponent</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>  <span class="p">)</span>
<span class="p">}</span>
</code></pre>
</div>
</div>
<div class='slide'>
<a class='slide_break' id='slide-16' href='slides_nextjs.html#slide-16'>▻</a>
<h4 id="you-can-pass-in-server-components-to-a-clientcomponent"><a class="anchorlink" href="#you-can-pass-in-server-components-to-a-clientcomponent">8.4 You can pass in Server Components to a ClientComponent</a></h4><div class="code_container">
<pre><code class="highlight js"><span class="c1">// this is outer_server_component.server.js</span>
<span class="k">import</span> <span class="nx">ClientComponent</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./ClientComponent.client</span><span class="dl">'</span>
<span class="k">import</span> <span class="nx">ServerComponent</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./ServerComponent.server</span><span class="dl">'</span>
<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">OuterServerComponent</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">ClientComponent</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">ServerComponent</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="sr">/ClientComponent</span><span class="err">&gt;
</span>  <span class="p">)</span>
<span class="p">}</span>
</code></pre>
</div>
</div>
<div class='slide'>
<a class='slide_break' id='slide-17' href='slides_nextjs.html#slide-17'>▻</a>
<h4 id="server-comopnents-cannot-pass-functions-to-its-descendents"><a class="anchorlink" href="#server-comopnents-cannot-pass-functions-to-its-descendents">8.5 Server Comopnents cannot pass functions to its descendents</a></h4><p>Because props are serialized into JSON, and functions cannot be serialized into JSON,
Server Components cannot pass functions as props to its descendents.</p><div class="code_container">
<pre><code class="highlight js"><span class="c1">// ERROR !!!!</span>
<span class="kd">function</span> <span class="nx">SomeServerComponent</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">OHHAI</span><span class="dl">'</span><span class="p">)}</span><span class="o">&gt;</span><span class="nx">Click</span> <span class="nx">me</span><span class="o">!&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span><span class="p">}</span>
<span class="c1">// ERROR !!!!</span>
</code></pre>
</div>
</div>
<div class='slide'>
<a class='slide_break' id='slide-18' href='slides_nextjs.html#slide-18'>▻</a>
<h4 id="how-rsc-works"><a class="anchorlink" href="#how-rsc-works">8.6 How RSC Works</a></h4><p>its complicated</p><p><a href="https://github.com/reactwg/server-components/discussions/5">RSC Components from Scratch</a></p><p><a href="https://www.plasmic.app/blog/how-react-server-components-work">How Server Components Work</a></p></div>
<div class='slide'>
<a class='slide_break' id='slide-19' href='slides_nextjs.html#slide-19'>▻</a>
<h3 id="hosting-next-js"><a class="anchorlink" href="#hosting-next-js">9 Hosting next.js</a></h3><p>Vercel, the company behind next.js, offers hosting on their platform. There is a free tier.</p><p>To host next.js you need:</p>
<ul>
<li>to run the build step to create static assets and javascript bundles</li>
<li>to run node.js on the server</li>
</ul>
<p>If you are using dokku a node.js buildpack will be chosen by default,
and do both for you. you might additionally consider:</p>
<ul>
<li>setting up permanent storage at <code>public/upload</code>, if you want to handle uploaded file and store them in the webspcae</li>
<li>setting up a database</li>
</ul>
</div>
<div class='slide'>
<a class='slide_break' id='slide-20' href='slides_nextjs.html#slide-20'>▻</a>
<h3 id="see-also"><a class="anchorlink" href="#see-also">10 See Also</a></h3>
<ul>
<li><a href="https://nextjs.org/docs">Next.js Documentation</a></li>
<li><a href="https://nextjsweekly.com/">Next.js Newsletter</a></li>
</ul>
</div>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p class="copyright">published under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/at/deed.de">creative commons by-nc-sa</a> in 2012-2022 by <a href="https://brigitte-jellinek.at">Brigitte Jellinek</a>.
      </p><p>If you want to contribute: <a href="https://github.com/backend-development/backend-development-textbook/fork">fork the source on github</a>
      </p>
    </div>
  </div>

  <script src="javascripts/jquery.min.js"></script>
  <script src="javascripts/guides.js"></script>
  <script>
    SyntaxHighlighter.all()
    $(guidesIndex.bind);
    $(document).ready(function(){
      let hash = document.location.hash;
      if(! hash) return;
      document.getElementById(hash.substr(1)).scrollIntoView(true);
    })
  </script>
  </body>
</html>
