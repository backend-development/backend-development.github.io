<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Backend Development Textbook</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

  <link rel="stylesheet" type="text/css" href="stylesheets/code.css" />
  
  <link rel="stylesheet" type="text/css" href="stylesheets/fixes.css" />

  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  <style>

    .slide img[src$=svg] {
      width: 100%;
    }
  </style>
</head>
<body class="guide">
  <div>
    <a href="https://github.com/backend-development/backend-development-textbook/"><img style="position: fixed; top: 0; right: 0; border: 0; z-index: 10;" src="images/forkme.png" alt="Fork me on GitHub"></a>
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">More Rails: </strong>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://guides.rubyonrails.org/">Rails Guides</a></li>
        <li class="more-info"><a href="https://curriculum.railsbridge.org/docs/">Railsbridge</a></li>
        <li class="more-info"><a href="https://archive.org/details/podcast_railscasts_218282043">Railscasts</a></li>
      </ul>
      <strong class="more-info-label">Beyond Backend: </strong>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://web-engineering.github.io/">Web Engineering</a></li>
      </ul>      
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="Return to home page">Backend<span> Development</span></a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">Home</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" onclick="guideMenu(); return false;" id="guidesMenu" class="guides-index-item nav-item">Index  &#x25BC;</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
              <dl class="L">
                <dt>Ruby on Rails</dt>
                <dd><a href="ruby_commandline.html">Ruby Commandline</a></dd>
                <dd><a href="rails_database_and_model.html">Database and Models</a></dd>
                <dd><a href="rails_associations_and_validations.html">Associations and Validations</a></dd>
                <dd><a href="rails_view_and_controller.html">Routing, View and Controller</a></dd>
                <dd><a href="rails_authentication.html">Simple Authentication</a></dd>
                <dd><a href="assets_and_webpacker.html">Assets and Webpacker</a></dd>
                <dd><a href="javascript_and_ajax.html">Javascript and Rails</a></dd>
                <dd><a href="testing.html">Getting started with Testing</a></dd>
                <dd><a href="rails_gems.html">Ruby Gems for your Rails Project</a></dd>
                <dd><a href="rest-api.html">REST API</a></dd>
                <dd><a href="graphql-api.html">GraphQL API</a></dd>
                <dd><a href="rails_websockets.html">Websocket in Rails</a></dd>
                <dd><a href="jobs_and_tasks.html">Jobs and Tasks in Rails</a></dd>
                <dd><a href="refactoring_rails.html">Refactoring Rails</a></dd>
                <dt>Overarching Concerns</dt>
                <dd><a href="security.html">Security</a></dd>
                <dd><a href="adv_authentication.html">Advanced Authentication</a></dd>
                <dd><a href="caching.html">Caching</a></dd>
                <dd><a href="advanced_testing.html">Advanced Testing</a></dd>
                <dd><a href="internationalization.html">Internationalization (I18n)</a></dd>
                <dt>Nodes.js</dt>
                <dd><a href="node_vs_rails.html">Node vs. Rails</a></dd>
                <dd><a href="node_basics.html">Node Basics</a></dd>
                <dd><a href="node_websockets.html">Node Websockets</a></dd>
                <dd><a href="node_express.html">Node Web App</a></dd>
                <dd><a href="node_cluster.html">Scaling Node</a></dd>
              </dl>
              <dl class="R">
              </dl>
          </div>
        </li>
      </ul>
    </div>
  </div>

  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2 id="preheader">no heading</h2>
                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li>
<a href="#rails-from-the-outside-in">Rails from the Outside In</a>

<ul>
<li><a href="#start-a-rails-project">Start a Rails Project</a></li>
<li><a href="#rails-directory-structure">Rails Directory Structure</a></li>
<li><a href="#start-the-webserver">Start the Webserver</a></li>
</ul>
</li>
<li><a href="#make-it-a-git-repository">Make it a Git Repository</a></li>
<li>
<a href="#scaffold">Scaffold</a>

<ul>
<li><a href="#migration">Migration</a></li>
<li><a href="#use-your-app">Use your app</a></li>
<li><a href="#view">View</a></li>
<li><a href="#model">Model</a></li>
<li><a href="#summary">Summary</a></li>
</ul>
</li>
</ol>

          </div>

      <div class="rest_header">
        
      </div>
    </div>
  </div>


  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <div class='slide'><a id='slide-0'></a>
</div>
<div class='slide'>
<a class='slide_break' id='slide-1' href='slides_rails_with_scaffold.html#slide-1'>▻</a>
<h2>Rails with Scaffold</h2><p>We will build our first rails project but we will not really understand
everything - that comes later.</p><p>After finishing this guide you will</p>
<ul>
<li>have finished your first rails project</li>
<li>know how to use the scaffold generator</li>
<li>know about the main folders of a rails project: <code>config</code>, <code>db</code>, <code>app</code>
</li>
<li>have an overview of what model, view, controller (MVC) means in rails</li>
</ul>

</div>
<div class='slide'>
<a class='slide_break' id='slide-2' href='slides_rails_with_scaffold.html#slide-2'>▻</a>
<hr>
</div>
<div class='slide'>
<a class='slide_break' id='slide-3' href='slides_rails_with_scaffold.html#slide-3'>▻</a>
<h3 id="rails-from-the-outside-in"><a class="anchorlink" href="#rails-from-the-outside-in">1 Rails from the Outside In</a></h3><p>Let's look at a fairly complex web application - the course
management system for a university. How would the code for this
app be organized, if it is written in Ruby on Rails?</p><p>The course management system surely deals with courses in some
way.</p><p>Rails is organized along the distinction of model - view - controller (MVC).
In our exmple we would find:</p>
<ul>
<li>an entry in <code>conf/route.rb</code> that configures the mapping of URLs and parameters to the controller</li>
<li>several templates for courses in the folder <code>app/views/courses/</code>
</li>
<li>a ruby class in the <code>apps/controllers</code> folder with the class name <code>CourseController</code>
</li>
<li>a ruby class in the <code>app/models</code> folder with the class name <code>Course</code>
</li>
<li>a relational database in the backend. this database contains a table <code>courses</code>
</li>
</ul>
<p>As a rails programmer you know about all these folders and files. If you are
told that there is a problem in the webpage with url <a href="http://myapp.com/courses/5/edit">http://myapp.com/courses/5/edit</a>
you immediately
know to look in conf/routes.rb to find out exactly which files are concerned,
but that the most likely canditates are</p>
<ul>
<li>app/models/course.rb</li>
<li>app/controller/course_controller.b</li>
<li>app/views/course/edit.html.erb</li>
</ul>
<p>If you have not used a framework before this might feel very restrictive in the
beginning: you can't just make up filenames any way you want, there is a
<strong>convention</strong> for everything.</p><p>You have to stick to the convention if you want to profit from the framework,
it will make your work as a programmer a lot easier.
And you will profit from this convention
every time you look at a new project - you'll instantly know your way around.</p></div>
<div class='slide'>
<a class='slide_break' id='slide-4' href='slides_rails_with_scaffold.html#slide-4'>▻</a>
<h4 id="start-a-rails-project"><a class="anchorlink" href="#start-a-rails-project">1.1 Start a Rails Project</a></h4><p>Before you can start your first rails project you have
to install ruby and the rails gem on your computer.</p><p>A word of warning: Ruby and Rails will work on any Unix, including Mac OS.
To use them on a windows system you need a lot more patience and troubleshooting
ability. So if you are a windows user you might consider running
ruby and rails in a virtual (unix) machine (without GUI) instead.</p><p>Make sure you are using a current ruby (&gt;= 2.3) and rails (&gt;= 5.0) before
you proceed:</p><div class="code_container">
<pre><code class="highlight sh"><span class="nv">$ </span><span class="nb">ruby</span> <span class="nt">-v</span>
<span class="nb">ruby </span>2.3.1p112 <span class="o">(</span>2016-04-26 revision 54768<span class="o">)</span> <span class="o">[</span>x86_64-darwin15]
<span class="nv">$ </span><span class="nb">rails</span> <span class="nt">-v</span>
Rails 5.0.0.1
</code></pre>
</div>
<p>Another word of warning: rails moves fast. This textbook first written in the fall
of 2012 for rails 3.2, and has been updated every year until fall 2016.
If you are reading this in the far future (which in rails terms means: in late 1017 or later)
you are probably using ruby 3 or later, and rails 6 or later, and this text is <strong>not</strong> for you!</p><p>Before you start your rails project you have to decide on the name (and folder
name) of your application. The name of application cannot easily be changed
afterwards! In the following example we create an app called 'alljokes':</p><div class="code_container">
<pre><code class="highlight sh"><span class="nb">rails </span>new alljokes <span class="nt">-T</span>
</code></pre>
</div>
<p>The last step that was run automatically when creating a new rails project is <code>bundle install</code>.
This will try to look up gems on the internet - if you are not connected
to the internet you will be stuck here. You could try <code>bundle install --local</code> instead,
that might help if the gems are installed on your computer already.</p></div>
<div class='slide'>
<a class='slide_break' id='slide-5' href='slides_rails_with_scaffold.html#slide-5'>▻</a>
<h4 id="rails-directory-structure"><a class="anchorlink" href="#rails-directory-structure">1.2 Rails Directory Structure</a></h4><p>Rails will create a directory structure and about 40 files for you.
Let's start to look at a few of them:</p>
<ul>
<li>
<code>Gemfile</code> - in this file you specify which libraries (gems) your project uses</li>
<li>
<code>app</code>

<ul>
<li>
<code>model</code> - contains all the classes of models</li>
<li>
<code>view</code> - contains a folder full of templates for every controller</li>
<li>
<code>controller</code> - contains all the classes of controllers</li>
</ul>
</li>
<li>
<code>config</code>

<ul>
<li>
<code>database.yml</code> - database configuration</li>
<li>
<code>routes.rb</code> - configuration of routes</li>
</ul>
</li>
<li>
<code>public</code> - the webspace. files in here are accessible without routing</li>
</ul>
<p>With your code split up into so many different files it is really useful
to haven an editor that not only helps you edit a single file, but that
will also display the directories and files. For example vim with NERDtree
or submline or RubyMine:</p><p><img src="images/directory-structure-editors.png" alt="Screenshot of editor vim with NERDtree and rubymine"></p></div>
<div class='slide'>
<a class='slide_break' id='slide-6' href='slides_rails_with_scaffold.html#slide-6'>▻</a>
<h4 id="start-the-webserver"><a class="anchorlink" href="#start-the-webserver">1.3 Start the Webserver</a></h4><p>Rails comes with a tiny webserver called <code>puma</code>. You start
it in your terminal window (and then you need another window to go on working)</p><div class="code_container">
<pre><code class="highlight sh"><span class="nv">$ </span><span class="nb">rails </span>server
</code></pre>
</div>
<p>Now you can point your browser at <code>http://localhost:3000/</code> to find the first
webpage of your app. It's just a dummy page that will vanish once
you add your own pages.</p></div>
<div class='slide'>
<a class='slide_break' id='slide-7' href='slides_rails_with_scaffold.html#slide-7'>▻</a>
<h3 id="make-it-a-git-repository"><a class="anchorlink" href="#make-it-a-git-repository">2 Make it a Git Repository</a></h3><p>A new rails project is already prepared to be turned
into a git repository: there is a <code>.gitignore</code> file in the main
folder. (If you are using rubymine you could add <code>/.idea</code> to
your <code>.gitignore</code> - that's the directory where rubymine stores
it's configuration. You probably want to keep that private to
each developer.</p><p>Create a new repository and commit in the current status:</p><div class="code_container">
<pre><code class="highlight sh"><span class="nv">$ </span><span class="nb">git </span>init <span class="nb">.</span>
Initialized empty Git repository <span class="k">in</span> /Developer/alljokes/.git/
<span class="nv">$ </span><span class="nb">git </span>add <span class="nb">.</span>

<span class="nv">$ </span><span class="nb">git </span>commit <span class="nt">-m</span> <span class="s1">'empty rails project'</span>
<span class="o">[</span>master <span class="o">(</span>root-commit<span class="o">)</span> 2b2053c] empty <span class="nb">rails </span>project
 66 files changed, 1881 insertions<span class="o">(</span>+<span class="o">)</span>
 create mode 100644 .gitignore
 ..
 create mode 100644 vendor/assets/stylesheets/.gitkeep
 create mode 100644 vendor/plugins/.gitkeep
</code></pre>
</div>
<p>From now on you should <code>commit</code> your changes after every
finished step of programming.</p></div>
<div class='slide'>
<a class='slide_break' id='slide-8' href='slides_rails_with_scaffold.html#slide-8'>▻</a>
<h3 id="scaffold"><a class="anchorlink" href="#scaffold">3 Scaffold</a></h3><p>A scaffold helps you build something. In Rails a scaffold
helps you generate code according to the conventions.</p><p>In our application we want to store jokes. Let's generate
the scaffold for that: We want a model called <code>joke</code> with
two attributes: a (short) title and a (longer) fulltext.</p><p>When we call the scaffold generator on the commandline
we need to specify the name of the model, and the names (and types)
of the attributes. short strings / varchars do not need a type at all.</p><div class="code_container">
<pre><code class="highlight sh"><span class="nv">$ </span><span class="nb">rails </span>generate scaffold joke title fulltext:text
      invoke  active_record
      create    db/migrate/20161112171526_create_jokes.rb
      create    app/models/joke.rb
</code></pre>
</div>
<p>This will generate about 30 lines of output, and create 15 new files.
We will work through the files we need step by step:</p></div>
<div class='slide'>
<a class='slide_break' id='slide-9' href='slides_rails_with_scaffold.html#slide-9'>▻</a>
<h4 id="migration"><a class="anchorlink" href="#migration">3.1 Migration</a></h4><p>The first file we have to look at is stored in <code>db/migrate</code>. The filename
will be different from the one shown above, because it contains a timestamp.</p><p>Inside the file you will find</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">CreateJokes</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">5.0</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:jokes</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:title</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">text</span> <span class="ss">:fulltext</span>

      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<p>This is ruby code to generate a database table. You can see the
two attrivbutes you specified when you called the generator. There is
also a line <code>t.timestamps</code> that will add two more attributes to the
table: <code>created_at</code> and <code>updated_at</code>. Rails handles these to values
automatically.</p><p>You can run the migration (tell ruby to actually create the table) by
typing in <code>rails db:migrate</code> on the command line:</p><div class="code_container">
<pre><code class="highlight sh"><span class="nv">$ </span><span class="nb">rails </span>db:migrate
<span class="o">==</span> 20161112171526 CreateJokes: migrating <span class="o">======</span>
<span class="nt">--</span> create_table<span class="o">(</span>:jokes<span class="o">)</span>
   -&gt; 0.0012s
<span class="o">==</span> 20161112171526 CreateJokes: migrated <span class="o">(</span>0.0013s<span class="o">)</span> <span class="o">===========</span>
</code></pre>
</div>
<p>This actually created the table in a sqlite3 database called
<code>db/development.sqlite3</code>. As a side effect it also dumped the current
database schema into <code>db/schema.rb</code> and created a two extra tables
<code>schema_migrations</code> and <code>ar_internal_metadata</code>.</p></div>
<div class='slide'>
<a class='slide_break' id='slide-10' href='slides_rails_with_scaffold.html#slide-10'>▻</a>
<h4 id="use-your-app"><a class="anchorlink" href="#use-your-app">3.2 Use your app</a></h4><p>After running the migration your app is ready to be used:
point your browser at <code>http://localhost:3000/jokes/</code> to start.</p><p>The scaffold generated four webpages that you can visit, to
list, show, create, edit and destroy jokes:</p><p><img src="images/scaffold-with-arrows.png?viewbox=0;0;900;820" alt="webpages created by the scaffold"></p>
<ul>
<li>
<code>/jokes/</code> is a list of all the jokes, with links to create, edit and destroy them</li>
<li>
<code>/jokes/1</code> shows a single joke, in this case the joke with id=1</li>
<li>
<code>/jokes/new</code> shows a form used to enter a new joke</li>
<li>
<code>/jokes/1/edit</code> shows a form to edit a joke, in this case the joke with id=1</li>
</ul>
</div>
<div class='slide'>
<a class='slide_break' id='slide-11' href='slides_rails_with_scaffold.html#slide-11'>▻</a>
<h4 id="view"><a class="anchorlink" href="#view">3.3 View</a></h4><p>You can find the views that correspond to the webpages in <code>app/views/jokes</code>. Try to add a bit
of html to the following two views:</p>
<ul>
<li>
<code>index.html.erb</code> is a list of all the jokes, with links to create, edit and destroy them</li>
<li>
<code>show.html.erb</code> shows a single joke</li>
</ul>
</div>
<div class='slide'>
<a class='slide_break' id='slide-12' href='slides_rails_with_scaffold.html#slide-12'>▻</a>
<h4 id="model"><a class="anchorlink" href="#model">3.4 Model</a></h4><p>The model is stored in <code>app/models</code>. Add the following validation:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Joke</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
</div>
<p>This tell the model not only accept jokes that have a title.</p><p>Now try to enter a new joke without a title, you should get a
error message:</p><p><img src="images/error-validation.png" alt="Error message caused by unfullfilled validation"></p></div>
<div class='slide'>
<a class='slide_break' id='slide-13' href='slides_rails_with_scaffold.html#slide-13'>▻</a>
<h4 id="summary"><a class="anchorlink" href="#summary">3.5 Summary</a></h4><p>We built a first rails app and ran it locally on our own machine.
You should now have an overview over the most important files
and a first impression of ruby code (used in controllers, models)
and embedded ruby (erb) used in the views.</p><p>Congratulations on your first step!</p></div>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p class="copyright">published under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/at/deed.de">creative commons by-nc-sa</a> in 2012-2022 by <a href="https://brigitte-jellinek.at">Brigitte Jellinek</a>.
      </p><p>If you want to contribute: <a href="https://github.com/backend-development/backend-development-textbook/fork">fork the source on github</a>
      </p>
    </div>
  </div>

  <script src="javascripts/jquery.min.js"></script>
  <script src="javascripts/guides.js"></script>
  <script>
    SyntaxHighlighter.all()
    $(guidesIndex.bind);
    $(document).ready(function(){
      let hash = document.location.hash;
      if(! hash) return;
      document.getElementById(hash.substr(1)).scrollIntoView(true);
    })
  </script>
  </body>
</html>
